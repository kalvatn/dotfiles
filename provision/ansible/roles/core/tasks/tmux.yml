- name: check tmux version
  shell: tmux -V | cut -d ' ' -f2 | cut -d '.' -f1
  register: tmux_version

- name: remove existing tmux
  when: tmux_version.stdout != "2"
  become: yes
  apt: pkg=tmux state=removed

- name: install tmux build dependencies
  become: yes
  apt: pkg="{{item}}" state=latest
  with_items:
    - libevent-dev
    - libncurses5-dev

- name: clone tmux source
  when: tmux_version.stdout != "2"
  git: repo=https://github.com/tmux/tmux.git dest=/tmp/tmux

- name: build tmux from source
  when: tmux_version.stdout != "2"
  shell: sh autogen.sh && ./configure && sudo checkinstall -y
  args:
    chdir: /tmp/tmux
    executable: /bin/bash

- name: link .tmux.conf
  file:
    src: "{{role_path}}/files/.tmux.conf"
    dest: "{{user_home}}/.tmux.conf"
    state: link
